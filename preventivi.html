<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Strumento preventivi – Emir Alili</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    main {
      padding: 2.1rem 0 3rem;
    }

    .tool-box {
      max-width: 920px;
      margin: 0 auto;
    }

    .tool-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: 1.5rem;
      margin-top: 1rem;
    }

    @media (max-width: 880px) {
      .tool-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .tool-field {
      margin-bottom: 0.9rem;
    }

    .tool-label {
      display: block;
      font-size: 0.86rem;
      font-weight: 500;
      color: #111827;
      margin-bottom: 0.2rem;
    }

    .tool-hint {
      font-size: 0.78rem;
      color: #6b7280;
      margin-bottom: 0.25rem;
    }

    .tool-input-row {
      display: flex;
      gap: 0.4rem;
      align-items: center;
    }

    .tool-input,
    .tool-select {
      flex: 1;
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      padding: 0.45rem 0.6rem;
      font-size: 0.9rem;
      outline: none;
      background: #ffffff;
    }

    .tool-input:focus,
    .tool-select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(234, 88, 12, 0.15);
    }

    .tool-suffix {
      font-size: 0.8rem;
      color: #6b7280;
      white-space: nowrap;
    }

    .tool-note {
      font-size: 0.76rem;
      color: #6b7280;
      margin-top: 0.2rem;
    }

    .tool-results {
      background: var(--bg-soft);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      padding: 1rem 1rem 0.9rem;
      font-size: 0.86rem;
      color: var(--text-muted);
    }

    .tool-results-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #111827;
      margin-bottom: 0.4rem;
    }

    .tool-results-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 0.35rem;
      margin-top: 0.2rem;
    }

    .tool-result-row {
      display: flex;
      justify-content: space-between;
      gap: 0.7rem;
    }

    .tool-result-label {
      color: #6b7280;
    }

    .tool-result-value {
      font-weight: 600;
      color: #111827;
    }

    .tool-result-highlight {
      margin-top: 0.45rem;
      padding-top: 0.45rem;
      border-top: 1px dashed var(--border-subtle);
    }

    .tool-result-highlight .tool-result-value {
      color: var(--accent-dark);
    }

    .tool-buttons {
      margin-top: 1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- HEADER (uguale alle altre pagine, senza link nel menu) -->
    <header>
      <div class="container">
        <nav class="nav" id="nav">
          <div class="brand">
            <div class="brand-avatar">
              <img src="assets/img/Emir%20primo%20piano.jpg" alt="Emir Alili" />
            </div>
            <div class="brand-text">
              <strong>Emir Alili</strong>
              <span>Imprenditore, autore, leader politico</span>
            </div>
          </div>

          <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="chi-sono.html">Chi sono</a>
            <a href="cosa-faccio.html">Cosa faccio</a>
            <a href="contatti.html">Contatti</a>
          </div>

          <div class="nav-cta">
            <button class="btn-header" type="button" onclick="window.location.href='contatti.html'">
              Contatti
            </button>
          </div>

          <button class="nav-toggle" type="button" aria-label="Menu" id="navToggle">
            ☰
          </button>
        </nav>
      </div>
    </header>

    <!-- HERO -->
    <div class="hero-wrap">
      <section class="hero">
        <div class="container">
          <div class="hero-grid">
            <div>
              <div class="hero-kicker">
                <span>Strumento interno</span> preventivi pulizie
              </div>
              <h1 class="hero-title">
                Calcolatore rapido per <span>preventivi EA Cleaning</span>.
              </h1>
              <p class="hero-subtitle">
                Inserisci pochi parametri base e ottieni ore mensili, costi vivi aziendali
                e prezzo finale al cliente. Lo usi solo tu, come foglio di lavoro veloce.
              </p>
              <div class="hero-pills">
                <span class="pill">Frequenza · ore · km</span>
                <span class="pill">Costo orario dipendente</span>
                <span class="pill">Prodotti · commissione · ricarico</span>
              </div>
            </div>

            <aside class="hero-card">
              <div class="hero-name">EA Cleaning – strumento di lavoro</div>
              <div class="hero-role-main">
                Costi vivi separati: lavoro, auto, prodotti, commissioni.
              </div>
              <div class="hero-stat-grid">
                <div class="hero-stat-card">
                  <div class="hero-stat-number">12 / 14 / 16 €</div>
                  <div class="hero-stat-label">Costi orari dipendenti / collaboratori</div>
                </div>
                <div class="hero-stat-card">
                  <div class="hero-stat-number">0,30 €/km</div>
                  <div class="hero-stat-label">Costo auto standard</div>
                </div>
                <div class="hero-stat-card">
                  <div class="hero-stat-number">7 %</div>
                  <div class="hero-stat-label">Prodotti su lavoro + auto</div>
                </div>
              </div>
            </aside>
          </div>
        </div>
      </section>
    </div>

    <!-- CONTENUTO -->
    <main>
      <div class="container">
        <section class="section-box tool-box">
          <div class="section-header">
            <h2 class="section-title"><span>//</span> Parametri di lavoro</h2>
            <p class="section-subtitle">
              I parametri definiscono i costi vivi aziendali: dipendenti, auto, prodotti e
              commissioni. Il margine di ricarico viene applicato sopra questi costi.
            </p>
          </div>

          <div class="tool-grid">
            <!-- COLONNA INPUT -->
            <div>
              <!-- Commissione procacciatore -->
              <div class="tool-field">
                <label class="tool-label" for="commissionePerc">Commissione procacciatore</label>
                <p class="tool-hint">Percentuale sul prezzo mensile al cliente (facoltativa).</p>
                <div class="tool-input-row">
                  <input class="tool-input" type="number" id="commissionePerc" placeholder="Es. 10" />
                  <span class="tool-suffix">% (facoltativo)</span>
                </div>
                <p class="tool-note">
                  La commissione viene calcolata sul prezzo base al cliente e
                  sommata ai costi aziendali come costo vivo.
                </p>
              </div>

              <!-- Frequenza -->
              <div class="tool-field">
                <label class="tool-label" for="freq">Frequenza settimanale</label>
                <p class="tool-hint">Numero interventi a settimana.</p>
                <div class="tool-input-row">
                  <input class="tool-input" type="number" id="freq" value="2" step="0.5" />
                  <span class="tool-suffix">interv./sett.</span>
                </div>
              </div>

              <!-- Durata per intervento -->
              <div class="tool-field">
                <label class="tool-label" for="oreInt">Durata per intervento</label>
                <p class="tool-hint">Ore totali di tutte le persone presenti (se sono 2 persone per 1h, inserisci 2).</p>
                <div class="tool-input-row">
                  <input class="tool-input" type="number" id="oreInt" value="2" step="0.25" />
                  <span class="tool-suffix">ore / intervento</span>
                </div>
              </div>

              <!-- Km per intervento -->
              <div class="tool-field">
                <label class="tool-label" for="kmInt">Km per intervento</label>
                <p class="tool-hint">Km totali andata + ritorno per ogni intervento.</p>
                <div class="tool-input-row">
                  <input class="tool-input" type="number" id="kmInt" value="0" step="0.1" />
                  <span class="tool-suffix">km / intervento</span>
                </div>
                <p class="tool-note">
                  Il costo auto è calcolato a 0,30 €/km × frequenza × 4,33.
                </p>
              </div>

              <!-- Costo orario -->
              <div class="tool-field">
                <label class="tool-label" for="costoOra">Costo orario aziendale</label>
                <p class="tool-hint">Seleziona il costo aziendale dipendente: 12, 14 o 16 €/h in base al profilo.</p>
                <div class="tool-input-row">
                  <select class="tool-select" id="costoOra">
                    <option value="12">12,00 €/h</option>
                    <option value="14" selected>14,00 €/h</option>
                    <option value="16">16,00 €/h</option>
                  </select>
                  <span class="tool-suffix">€/h costo</span>
                </div>
              </div>

              <!-- Margine desiderato -->
              <div class="tool-field">
                <label class="tool-label" for="marginePerc">Margine desiderato</label>
                <p class="tool-hint">
                  Percentuale di ricarico sui costi aziendali (lavoro + auto + prodotti + commissione).
                </p>
                <div class="tool-input-row">
                  <input class="tool-input" type="number" id="marginePerc" placeholder="Es. 40" />
                  <span class="tool-suffix">% margine</span>
                </div>
              </div>

              <div class="tool-buttons">
                <button class="btn-primary" type="button" id="calcolaBtn">Calcola preventivo</button>
                <button class="btn-outline" type="button" id="resetBtn">Reset</button>
              </div>
            </div>

            <!-- COLONNA RISULTATI -->
            <aside class="tool-results" id="pdfArea">
              <div class="tool-results-title">Risultato preventivo mensile</div>
              <div class="tool-results-grid">
                <div class="tool-result-row">
                  <span class="tool-result-label">Ore totali mese</span>
                  <span class="tool-result-value" id="oreMese">0,00 h</span>
                </div>

                <div class="tool-result-row">
                  <span class="tool-result-label">Costo lavoro mese</span>
                  <span class="tool-result-value" id="costoLavoro">0,00 €</span>
                </div>

                <div class="tool-result-row">
                  <span class="tool-result-label">Costo auto mese</span>
                  <span class="tool-result-value" id="costoAuto">0,00 €</span>
                </div>

                <div class="tool-result-row">
                  <span class="tool-result-label">Costo prodotti (7%)</span>
                  <span class="tool-result-value" id="costoProdotti">0,00 €</span>
                </div>

                <div class="tool-result-row">
                  <span class="tool-result-label">Costo totale aziendale (senza commissione)</span>
                  <span class="tool-result-value" id="costoTotaleBase">0,00 €</span>
                </div>

                <div class="tool-result-row">
                  <span class="tool-result-label">Prezzo base al cliente (senza commissione)</span>
                  <span class="tool-result-value" id="prezzoBase">0,00 €</span>
                </div>

                <div class="tool-result-row">
                  <span class="tool-result-label">Commissione procacciatore</span>
                  <span class="tool-result-value" id="commissioneEuro">0,00 €</span>
                </div>

                <div class="tool-result-row">
                  <span class="tool-result-label">Costo totale aziendale (con commissione)</span>
                  <span class="tool-result-value" id="costoTotale">0,00 €</span>
                </div>

                <div class="tool-result-row">
                  <span class="tool-result-label">Prezzo mensile al cliente (con commissione)</span>
                  <span class="tool-result-value" id="prezzoMese">0,00 €</span>
                </div>

                <div class="tool-result-row">
                  <span class="tool-result-label">Tariffa oraria di preventivo</span>
                  <span class="tool-result-value" id="tariffaOra">0,00 €/h</span>
                </div>

                <div class="tool-result-highlight">
                  <div class="tool-result-row">
                    <span class="tool-result-label">Margine in valore assoluto</span>
                    <span class="tool-result-value" id="margineEuro">0,00 €</span>
                  </div>
                  <div class="tool-result-row">
                    <span class="tool-result-label">Margine effettivo</span>
                    <span class="tool-result-value" id="margineEff">0,0 %</span>
                  </div>
                </div>
              </div>
              <p class="tool-note" style="margin-top:0.7rem;">
                Formula: ore mese = frequenza × ore/intervento × 4,33.<br />
                Costo lavoro = ore mese × costo orario.<br />
                Costo auto = km/intervento × 0,30 €/km × frequenza × 4,33.<br />
                Prodotti = 7% di (costo lavoro + costo auto).<br />
                Prezzo base cliente = (costi senza commissione) × (1 + margine%).<br />
                Commissione = prezzo base × commissione%. Prezzo finale = prezzo base + commissione.<br />
                Margine effettivo calcolato sul prezzo finale e sui costi totali (inclusa commissione).
              </p>
            </aside>
          </div>

          <div class="tool-buttons">
            <button class="btn-outline" type="button" id="pdfBtn">Esporta preventivo in PDF</button>
          </div>
        </section>
      </div>
    </main>

    <!-- FOOTER -->
    <footer>
      <div class="container">
        <div class="footer-inner">
          <div class="footer-links">
            <span>© <span id="year"></span> Emir Alili.</span>
            <span>Strumento interno preventivi EA Cleaning.</span>
          </div>
          <div class="footer-social">
            <a href="mailto:info@emiralili.it">Email</a>
            <a href="https://www.facebook.com/emir.alili.81/" target="_blank" rel="noopener noreferrer">Facebook</a>
            <a href="https://www.linkedin.com/in/emiralili/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <!-- Libreria per esportare in PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    const nav = document.getElementById("nav");
    const navToggle = document.getElementById("navToggle");
    if (nav && navToggle) {
      navToggle.addEventListener("click", () => {
        nav.classList.toggle("mobile-open");
      });
    }

    const commissioneInput = document.getElementById("commissionePerc");
    const freqInput = document.getElementById("freq");
    const oreIntInput = document.getElementById("oreInt");
    const kmIntInput = document.getElementById("kmInt");
    const costoOraSelect = document.getElementById("costoOra");
    const margineInput = document.getElementById("marginePerc");

    const oreMeseSpan = document.getElementById("oreMese");
    const costoLavoroSpan = document.getElementById("costoLavoro");
    const costoAutoSpan = document.getElementById("costoAuto");
    const costoProdottiSpan = document.getElementById("costoProdotti");
    const costoTotaleBaseSpan = document.getElementById("costoTotaleBase");
    const prezzoBaseSpan = document.getElementById("prezzoBase");
    const commissioneEuroSpan = document.getElementById("commissioneEuro");
    const costoTotaleSpan = document.getElementById("costoTotale");
    const prezzoMeseSpan = document.getElementById("prezzoMese");
    const tariffaOraSpan = document.getElementById("tariffaOra");
    const margineEuroSpan = document.getElementById("margineEuro");
    const margineEffSpan = document.getElementById("margineEff");

    function formatEuro(val) {
      return val.toFixed(2).replace(".", ",") + " €";
    }

    function formatOre(val) {
      return val.toFixed(2).replace(".", ",") + " h";
    }

    function formatPerc(val) {
      return val.toFixed(1).replace(".", ",") + " %";
    }

    function calcola() {
      const freq = parseFloat(freqInput.value) || 0;
      const oreInt = parseFloat(oreIntInput.value) || 0;
      const kmInt = parseFloat(kmIntInput.value) || 0;
      const costoOra = parseFloat(costoOraSelect.value) || 0;
      const marginePerc = parseFloat(margineInput.value) || 0;
      const commissionePerc = parseFloat(commissioneInput.value) || 0;

      const oreMese = freq * oreInt * 4.33;
      const costoLavoro = oreMese * costoOra;
      const costoAuto = kmInt * 0.30 * freq * 4.33;

      const baseCost = costoLavoro + costoAuto;
      const costoProdotti = baseCost * 0.07;
      const costoTotaleBase = baseCost + costoProdotti;

      const margineFactor = 1 + (marginePerc > 0 ? marginePerc / 100 : 0);
      const prezzoBase = costoTotaleBase * margineFactor;

      const commissioneEuro = commissionePerc > 0 ? prezzoBase * (commissionePerc / 100) : 0;
      const costoTotale = costoTotaleBase + commissioneEuro;

      const prezzoMese = prezzoBase + commissioneEuro;

      const tariffaOra = oreMese > 0 ? prezzoMese / oreMese : 0;
      const margineEuro = prezzoMese - costoTotale;
      const margineEff = prezzoMese > 0 ? (margineEuro / prezzoMese) * 100 : 0;

      oreMeseSpan.textContent = formatOre(oreMese);
      costoLavoroSpan.textContent = formatEuro(costoLavoro);
      costoAutoSpan.textContent = formatEuro(costoAuto);
      costoProdottiSpan.textContent = formatEuro(costoProdotti);
      costoTotaleBaseSpan.textContent = formatEuro(costoTotaleBase);
      prezzoBaseSpan.textContent = formatEuro(prezzoBase);
      commissioneEuroSpan.textContent = formatEuro(commissioneEuro);
      costoTotaleSpan.textContent = formatEuro(costoTotale);
      prezzoMeseSpan.textContent = formatEuro(prezzoMese);
      tariffaOraSpan.textContent = tariffaOra.toFixed(2).replace(".", ",") + " €/h";
      margineEuroSpan.textContent = formatEuro(margineEuro);
      margineEffSpan.textContent = formatPerc(margineEff);
    }

    document.getElementById("calcolaBtn").addEventListener("click", calcola);

    document.getElementById("resetBtn").addEventListener("click", () => {
      commissioneInput.value = "";
      freqInput.value = 2;
      oreIntInput.value = 2;
      kmIntInput.value = 0;
      costoOraSelect.value = "14";
      margineInput.value = "";
      calcola();
    });

    [commissioneInput, freqInput, oreIntInput, kmIntInput, costoOraSelect, margineInput].forEach(el => {
      el.addEventListener("input", calcola);
    });

    // Primo calcolo iniziale
    calcola();

    // PDF export
    const pdfBtn = document.getElementById("pdfBtn");
    const pdfArea = document.getElementById("pdfArea");

    if (pdfBtn && pdfArea) {
      pdfBtn.addEventListener("click", () => {
        const opt = {
          margin:       10,
          filename:     'preventivo-ea-cleaning.pdf',
          image:        { type: 'jpeg', quality: 0.98 },
          html2canvas:  { scale: 2 },
          jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        html2pdf().from(pdfArea).set(opt).save();
      });
    }
  </script>
</body>
</html>
